var __indexOf=[].indexOf||function(o){for(var t=0,e=this.length;e>t;t++)if(t in this&&this[t]===o)return t;return-1},__hasProp={}.hasOwnProperty,__extends=function(o,t){function e(){this.constructor=o}for(var n in t)__hasProp.call(t,n)&&(o[n]=t[n]);return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},__slice=[].slice;!function(o){var t,e;return o.Chooser=function(){function o(o){var t,e,n,s;for(this.model=o,this.model._chooser=this,s=this._publicMethods(),e=0,n=s.length;n>e;e++)t=s[e],this.model[t]=_.bind(this[t],this);this.chosen=!1,this.model.set({chosen:!1})}return o.prototype._publicMethods=function(){return["choose","unchoose","toggleChoose","isChosen"]},o.prototype.isChosen=function(){return!!this.chosen},o.prototype.choose=function(o){var t;return null==o&&(o={}),this.isChosen()?void 0:(this.chosen=!0,this.model.set({chosen:!0},o),o.silent!==!0&&this.model.trigger("model:chosen",this.model),null!=(t=this.model.collection)?"function"==typeof t.choose?t.choose(this.model,o):void 0:void 0)},o.prototype.unchoose=function(o){var t;return null==o&&(o={}),this.isChosen()?(this.chosen=!1,this.model.set({chosen:!1},o),o.silent!==!0&&this.model.trigger("model:unchosen",this.model),null!=(t=this.model.collection)?"function"==typeof t.unchoose?t.unchoose(this.model,o):void 0:void 0):void 0},o.prototype.toggleChoose=function(){return this.isChosen()?this.unchoose():this.choose()},o}(),t=function(){function o(o){var t,e,n,s;for(this.collection=o,this.collection._chooser=this,this.collection._chooser.chosen={},s=this._publicMethods(),e=0,n=s.length;n>e;e++)t=s[e],this.collection[t]=_.bind(this[t],this)}return o.prototype._publicMethods=function(){return["choose","unchoose","getChosen","getFirstChosen","chooseById"]},o.prototype.getChosen=function(){return _.toArray(this.chosen)},o.prototype.getFirstChosen=function(){return this.getChosen()[0]},o.prototype.modelInChosen=function(o){var t;return t=o.cid,__indexOf.call(_.keys(this.chosen),t)>=0},o.prototype.addModel=function(o,t){return null==t&&(t={}),this.chosen[o.cid]=o,"function"==typeof o.choose?o.choose(t):void 0},o.prototype.removeModels=function(o){var t,e,n,s;for(null==o&&(o=!1),n=_.flatten([o||this.getChosen()]),s=[],t=0,e=n.length;e>t;t++)o=n[t],delete this.chosen[o.cid],s.push("function"==typeof o.unchoose?o.unchoose():void 0);return s},o.prototype.triggerEvent=function(o,t){return null==o&&(o=!1),null==t&&(t={}),_.defaults(t,{silent:!1}),t.silent!==!0?(o||(o=this._getEvent()),this.collection.trigger(o,this.getChosen())):void 0},o.prototype.chooseById=function(o,t){var e;return null==t&&(t={}),e=this.collection.get(o),e?this.choose(e,t):void 0},o}(),o.SingleChooser=function(o){function t(){return e=t.__super__.constructor.apply(this,arguments)}return __extends(t,o),t.prototype.choose=function(o,t){return this.modelInChosen(o)?void 0:(this.removeModels(),this.addModel(o),this.triggerEvent("collection:chose:one",t))},t.prototype.unchoose=function(o,t){return this.modelInChosen(o)?(this.removeModels(o),this.triggerEvent("collection:unchose:one",t)):void 0},t}(t),o.MultiChooser=function(t){function e(){var o,t,n,s;for(e.__super__.constructor.apply(this,arguments),s=["chooseAll","chooseNone","chooseByIds"],t=0,n=s.length;n>t;t++)o=s[t],this.collection[o]=_.bind(this[o],this)}return __extends(e,t),e.prototype.choose=function(){var t,e,n,s,i,h,r;for(t=1<=arguments.length?__slice.call(arguments,0):[],s=_.chain(t).flatten().last().value()instanceof o.Model?{}:t.pop(),e=!1,r=_([t]).flatten(),i=0,h=r.length;h>i&&(n=r[i],!this.modelInChosen(n));i++)e||(e=!0),this.addModel(n,s);return e&&this.triggerEvent("collection:chose:any",s),e?this.triggerEvent(!1,s):void 0},e.prototype.unchoose=function(){var t,e,n,s,i,h,r;for(t=1<=arguments.length?__slice.call(arguments,0):[],s=_.chain(t).flatten().last().value()instanceof o.Model?{}:t.pop(),e=!1,r=_([t]).flatten(),i=0,h=r.length;h>i&&(n=r[i],this.modelInChosen(n));i++)e||(e=!0),this.removeModels(n,s);return e&&this.triggerEvent("collection:unchose:any",s),e?this.triggerEvent(!1,s):void 0},e.prototype.chooseAll=function(o){var t,e,n,s;if(null==o&&(o={}),_.difference(this.collection.models,this.getChosen()).length){for(s=this.collection.models,e=0,n=s.length;n>e;e++)t=s[e],this.addModel(t);return this.triggerEvent("collection:chose:any",o),this.triggerEvent(!1,o)}},e.prototype.chooseNone=function(o){return null==o&&(o={}),0!==this.getChosen().length?(this.removeModels(),this.triggerEvent("collection:unchose:any",o),this.triggerEvent(!1,o)):void 0},e.prototype.chooseByIds=function(o,t){var e,n,s,i,h;for(null==o&&(o=[]),null==t&&(t={}),_.defaults(t,{chooseNone:!0}),t.chooseNone&&this.chooseNone(t),i=_([o]).flatten(),h=[],n=0,s=i.length;s>n;n++)e=i[n],h.push(this.chooseById(e,t));return h},e.prototype._getEvent=function(){return this.collection.length===this.getChosen().length?"collection:chose:all":0===this.getChosen().length?"collection:chose:none":"collection:chose:some"},e}(t)}(Backbone);